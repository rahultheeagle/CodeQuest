<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Progress Dashboard - CodeQuest</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stats-card {
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
        }

        .stats-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }

        .stats-icon {
            font-size: 1.5rem;
        }

        .stats-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin: 0;
        }

        .stats-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stats-label {
            color: #666;
            font-size: 0.9rem;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto 15px;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
        }

        .progress-ring .bg {
            stroke: #e9ecef;
        }

        .progress-ring .progress {
            stroke: var(--primary);
            stroke-linecap: round;
            transition: stroke-dasharray 0.5s ease;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        .category-stats {
            display: grid;
            gap: 15px;
        }

        .category-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .category-name {
            font-weight: 500;
            text-transform: capitalize;
        }

        .category-progress {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .mini-progress {
            width: 60px;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
        }

        .mini-progress-fill {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .weekly-chart {
            display: flex;
            justify-content: space-between;
            align-items: end;
            height: 100px;
            margin-top: 15px;
        }

        .day-bar {
            flex: 1;
            margin: 0 2px;
            background: var(--primary);
            border-radius: 3px 3px 0 0;
            min-height: 4px;
            position: relative;
            transition: all 0.3s ease;
        }

        .day-bar:hover {
            background: var(--secondary);
        }

        .day-label {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            color: #666;
        }

        .challenge-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .challenge-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .challenge-item:last-child {
            border-bottom: none;
        }

        .challenge-info {
            flex: 1;
        }

        .challenge-name {
            font-weight: 500;
            margin-bottom: 2px;
        }

        .challenge-meta {
            font-size: 0.8rem;
            color: #666;
        }

        .challenge-stats {
            text-align: right;
            font-size: 0.9rem;
        }

        .status-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .status-completed {
            background: rgba(40, 167, 69, 0.2);
            color: #28a745;
        }

        .status-attempted {
            background: rgba(255, 193, 7, 0.2);
            color: #ffc107;
        }

        .status-not-started {
            background: rgba(108, 117, 125, 0.2);
            color: #6c757d;
        }

        .export-section {
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            margin-top: 20px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Progress Dashboard</h1>
            <nav>
                <a href="index.html" class="btn btn-secondary">‚Üê Back</a>
                <button class="btn btn-primary" onclick="refreshStats()">Refresh</button>
            </nav>
        </header>

        <div class="dashboard-grid">
            <!-- Overall Progress -->
            <div class="stats-card">
                <div class="stats-header">
                    <span class="stats-icon">üéØ</span>
                    <h3 class="stats-title">Overall Progress</h3>
                </div>
                <div class="progress-ring" id="overallProgress">
                    <svg>
                        <circle class="bg" cx="60" cy="60" r="52"></circle>
                        <circle class="progress" cx="60" cy="60" r="52" id="progressCircle"></circle>
                    </svg>
                    <div class="progress-text" id="progressText">0%</div>
                </div>
                <div style="text-align: center;">
                    <div class="stats-value" id="completedCount">0</div>
                    <div class="stats-label">Challenges Completed</div>
                </div>
            </div>

            <!-- Time Statistics -->
            <div class="stats-card">
                <div class="stats-header">
                    <span class="stats-icon">‚è±Ô∏è</span>
                    <h3 class="stats-title">Time Statistics</h3>
                </div>
                <div class="stats-value" id="totalTime">0h 0m</div>
                <div class="stats-label">Total Time Spent</div>
                <div style="margin-top: 15px;">
                    <div><strong>Average Time:</strong> <span id="averageTime">0s</span></div>
                    <div><strong>Today:</strong> <span id="todayTime">0s</span></div>
                    <div><strong>Fastest:</strong> <span id="fastestTime">0s</span></div>
                </div>
            </div>

            <!-- Attempt Statistics -->
            <div class="stats-card">
                <div class="stats-header">
                    <span class="stats-icon">üé≤</span>
                    <h3 class="stats-title">Attempt Statistics</h3>
                </div>
                <div class="stats-value" id="totalAttempts">0</div>
                <div class="stats-label">Total Attempts</div>
                <div style="margin-top: 15px;">
                    <div><strong>Average Attempts:</strong> <span id="averageAttempts">0</span></div>
                    <div><strong>Success Rate:</strong> <span id="successRate">0%</span></div>
                    <div><strong>Current Streak:</strong> <span id="streakDays">0 days</span></div>
                </div>
            </div>

            <!-- Category Progress -->
            <div class="stats-card">
                <div class="stats-header">
                    <span class="stats-icon">üìä</span>
                    <h3 class="stats-title">Category Progress</h3>
                </div>
                <div class="category-stats" id="categoryStats">
                    <!-- Category stats will be populated here -->
                </div>
            </div>
        </div>

        <!-- Weekly Activity -->
        <div class="stats-card">
            <div class="stats-header">
                <span class="stats-icon">üìÖ</span>
                <h3 class="stats-title">Weekly Activity</h3>
            </div>
            <div class="weekly-chart" id="weeklyChart">
                <!-- Weekly chart will be populated here -->
            </div>
        </div>

        <!-- Challenge Details -->
        <div class="stats-card">
            <div class="stats-header">
                <span class="stats-icon">üìù</span>
                <h3 class="stats-title">Challenge Details</h3>
            </div>
            <div class="challenge-list" id="challengeList">
                <!-- Challenge list will be populated here -->
            </div>
        </div>

        <!-- Export/Import Section -->
        <div class="export-section">
            <h3>Data Management</h3>
            <div class="button-group">
                <button class="btn btn-primary" onclick="exportProgress()">Export Progress</button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">Import Progress</button>
                <button class="btn btn-warning" onclick="resetProgress()">Reset Progress</button>
            </div>
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importProgress(event)">
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/progress-tracker.js"></script>
    <script>
        let progressTracker;
        let sampleChallenges = [
            { id: 1, title: "HTML Heading", category: "html", difficulty: "easy" },
            { id: 2, title: "CSS Styling", category: "css", difficulty: "easy" },
            { id: 3, title: "JavaScript Function", category: "javascript", difficulty: "medium" },
            { id: 4, title: "HTML List", category: "html", difficulty: "easy" },
            { id: 5, title: "CSS Flexbox", category: "css", difficulty: "medium" },
            { id: 6, title: "JavaScript Variables", category: "javascript", difficulty: "easy" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            progressTracker = new ProgressTracker();
            loadStats();
        });

        function loadStats() {
            const overallStats = progressTracker.getOverallStats();
            const categoryStats = progressTracker.getCategoryStats(sampleChallenges);
            const weeklyProgress = progressTracker.getWeeklyProgress();
            
            updateOverallProgress(overallStats);
            updateTimeStats(overallStats);
            updateAttemptStats(overallStats);
            updateCategoryStats(categoryStats);
            updateWeeklyChart(weeklyProgress);
            updateChallengeList();
        }

        function updateOverallProgress(stats) {
            const completionRate = progressTracker.getCompletionPercentage(sampleChallenges.length);
            const circle = document.getElementById('progressCircle');
            const text = document.getElementById('progressText');
            const count = document.getElementById('completedCount');
            
            const circumference = 2 * Math.PI * 52;
            const offset = circumference - (completionRate / 100) * circumference;
            
            circle.style.strokeDasharray = circumference;
            circle.style.strokeDashoffset = offset;
            
            text.textContent = Math.round(completionRate) + '%';
            count.textContent = stats.completedChallenges;
        }

        function updateTimeStats(stats) {
            document.getElementById('totalTime').textContent = stats.totalTime;
            document.getElementById('averageTime').textContent = stats.averageTime;
            document.getElementById('todayTime').textContent = progressTracker.formatTime(progressTracker.getTimeSpentToday());
            document.getElementById('fastestTime').textContent = progressTracker.formatTime(stats.fastestCompletion);
        }

        function updateAttemptStats(stats) {
            document.getElementById('totalAttempts').textContent = stats.totalAttempts;
            document.getElementById('averageAttempts').textContent = stats.averageAttempts;
            document.getElementById('successRate').textContent = stats.completionRate + '%';
            document.getElementById('streakDays').textContent = stats.streakDays + ' days';
        }

        function updateCategoryStats(categoryStats) {
            const container = document.getElementById('categoryStats');
            
            container.innerHTML = Object.entries(categoryStats).map(([category, stats]) => `
                <div class="category-item">
                    <div class="category-name">${category}</div>
                    <div class="category-progress">
                        <span>${stats.completed}/${stats.total}</span>
                        <div class="mini-progress">
                            <div class="mini-progress-fill" style="width: ${stats.completionRate}%"></div>
                        </div>
                        <span>${Math.round(stats.completionRate)}%</span>
                    </div>
                </div>
            `).join('');
        }

        function updateWeeklyChart(weeklyData) {
            const container = document.getElementById('weeklyChart');
            const maxChallenges = Math.max(...weeklyData.map(d => d.challenges), 1);
            
            container.innerHTML = weeklyData.map(day => {
                const height = (day.challenges / maxChallenges) * 80 + 4;
                return `
                    <div class="day-bar" style="height: ${height}px" title="${day.challenges} challenges on ${day.date}">
                        <div class="day-label">${day.day}</div>
                    </div>
                `;
            }).join('');
        }

        function updateChallengeList() {
            const container = document.getElementById('challengeList');
            
            container.innerHTML = sampleChallenges.map(challenge => {
                const stats = progressTracker.getChallengeStats(challenge.id);
                let status = 'not-started';
                let statusText = 'Not Started';
                
                if (stats) {
                    if (stats.completed) {
                        status = 'completed';
                        statusText = 'Completed';
                    } else if (stats.attempts > 0) {
                        status = 'attempted';
                        statusText = `${stats.attempts} attempts`;
                    }
                }
                
                return `
                    <div class="challenge-item">
                        <div class="challenge-info">
                            <div class="challenge-name">${challenge.title}</div>
                            <div class="challenge-meta">${challenge.category} ‚Ä¢ ${challenge.difficulty}</div>
                        </div>
                        <div class="challenge-stats">
                            <div class="status-badge status-${status}">${statusText}</div>
                            ${stats ? `<div>Time: ${stats.timeSpent}</div>` : ''}
                            ${stats && stats.bestTime !== 'N/A' ? `<div>Best: ${stats.bestTime}</div>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function refreshStats() {
            loadStats();
            Utils.showNotification('Statistics refreshed!', 'success');
        }

        function exportProgress() {
            const data = progressTracker.exportProgress();
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `codequest-progress-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            Utils.showNotification('Progress exported!', 'success');
        }

        function importProgress(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    if (progressTracker.importProgress(data)) {
                        loadStats();
                        Utils.showNotification('Progress imported successfully!', 'success');
                    } else {
                        Utils.showNotification('Invalid progress file format!', 'error');
                    }
                } catch (error) {
                    Utils.showNotification('Error reading progress file!', 'error');
                }
            };
            reader.readAsText(file);
        }

        function resetProgress() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone.')) {
                progressTracker.resetProgress();
                loadStats();
                Utils.showNotification('Progress reset successfully!', 'warning');
            }
        }

        // Simulate some progress for demo
        function simulateProgress() {
            // Simulate completing some challenges
            progressTracker.startChallenge(1);
            setTimeout(() => {
                progressTracker.submitAttempt(1, { valid: true, score: 1 });
                
                progressTracker.startChallenge(2);
                setTimeout(() => {
                    progressTracker.submitAttempt(2, { valid: false, score: 0.6 });
                    progressTracker.submitAttempt(2, { valid: true, score: 1 });
                    loadStats();
                }, 1000);
            }, 2000);
        }

        // Uncomment to simulate progress on page load
        // setTimeout(simulateProgress, 1000);
    </script>
</body>
</html>