<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Challenges - CodeQuest</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/animations.css">
    <style>
        .challenge-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .challenge-card {
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 20px;
            transition: transform 0.2s ease;
        }

        .challenge-card:hover {
            transform: translateY(-2px);
        }

        .challenge-card.completed {
            border-left: 4px solid var(--success);
        }

        .challenge-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .challenge-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin: 0;
        }

        .challenge-meta {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .difficulty-easy { background: var(--success); }
        .difficulty-medium { background: var(--warning); }
        .difficulty-hard { background: var(--danger); }

        .xp-badge {
            background: var(--info);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .challenge-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .code-input {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            resize: vertical;
            margin-bottom: 15px;
        }

        .challenge-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .challenge-result {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 500;
        }

        .result-success {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .result-error {
            background: rgba(244, 67, 54, 0.1);
            color: var(--danger);
            border: 1px solid var(--danger);
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-select {
            padding: 8px 12px;
            border: 1px solid var(--border);
            border-radius: 5px;
            background: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Coding Challenges</h1>
            <nav>
                <a href="index.html" class="btn btn-secondary">‚Üê Back</a>
                <a href="editor.html" class="btn btn-primary">Code Editor</a>
            </nav>
        </header>

        <div class="filters">
            <select class="filter-select" id="categoryFilter" onchange="filterChallenges()">
                <option value="">All Categories</option>
                <option value="html">HTML</option>
                <option value="css">CSS</option>
                <option value="javascript">JavaScript</option>
            </select>
            <select class="filter-select" id="difficultyFilter" onchange="filterChallenges()">
                <option value="">All Difficulties</option>
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
            </select>
        </div>

        <div class="challenge-grid" id="challengeContainer">
            <!-- Challenges will be loaded here -->
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/progress-tracker.js"></script>
    <script src="js/achievements.js"></script>
    <script>
        class ChallengeSystem {
            constructor() {
                this.challenges = [];
                this.storage = new Storage();
                this.userProgress = this.storage.get('challengeProgress') || { completed: [], totalXP: 0 };
                this.init();
            }

            async init() {
                await this.loadChallenges();
                this.renderChallenges();
            }

            async loadChallenges() {
                try {
                    const response = await fetch('data/challenges.json');
                    this.challenges = await response.json();
                } catch (error) {
                    this.challenges = this.getDefaultChallenges();
                }
            }

            getDefaultChallenges() {
                return [
                    {
                        id: 1,
                        title: "Create Your First Heading",
                        category: "html",
                        difficulty: "easy",
                        xp: 50,
                        description: "Create an h1 element with the text 'Hello World'",
                        starterCode: "<!-- Write your code here -->",
                        solution: "<h1>Hello World</h1>",
                        hints: ["Use the h1 tag", "Don't forget to close the tag"],
                        validation: function(code) {
                            return code.includes("<h1>") && code.includes("Hello World");
                        }
                    },
                    {
                        id: 2,
                        title: "Style Your Text",
                        category: "css",
                        difficulty: "easy",
                        xp: 75,
                        description: "Make the h1 element red using CSS",
                        starterCode: "h1 {\n  /* Add your styles here */\n}",
                        solution: "h1 {\n  color: red;\n}",
                        hints: ["Use the color property", "Set the value to red"],
                        validation: function(code) {
                            return code.includes("color") && code.includes("red");
                        }
                    },
                    {
                        id: 3,
                        title: "Add Interactivity",
                        category: "javascript",
                        difficulty: "medium",
                        xp: 100,
                        description: "Create a button that shows an alert when clicked",
                        starterCode: "// Write your JavaScript here",
                        solution: "document.querySelector('button').addEventListener('click', () => alert('Hello!'));",
                        hints: ["Use addEventListener", "Use the 'click' event", "Call alert() function"],
                        validation: function(code) {
                            return code.includes("addEventListener") && code.includes("click") && code.includes("alert");
                        }
                    }
                ];
            }

            renderChallenges() {
                const container = document.getElementById('challengeContainer');
                container.innerHTML = this.challenges.map(challenge => `
                    <div class="challenge-card ${this.isCompleted(challenge.id) ? 'completed' : ''}" 
                         data-category="${challenge.category}" 
                         data-difficulty="${challenge.difficulty}">
                        <div class="challenge-header">
                            <h3 class="challenge-title">${challenge.title}</h3>
                            <div class="challenge-meta">
                                <span class="badge difficulty-${challenge.difficulty}">${challenge.difficulty}</span>
                                <span class="xp-badge">${challenge.xp} XP</span>
                            </div>
                        </div>
                        <p class="challenge-description">${challenge.description}</p>
                        <textarea class="code-input" id="code-${challenge.id}" placeholder="Write your code here...">${challenge.starterCode}</textarea>
                        <div class="challenge-actions">
                            <button class="btn btn-primary" onclick="challengeSystem.submitChallenge(${challenge.id})">Submit</button>
                            <button class="btn btn-secondary" onclick="challengeSystem.showHint(${challenge.id})">Hint</button>
                            <button class="btn btn-warning" onclick="challengeSystem.showSolution(${challenge.id})">Solution</button>
                        </div>
                        <div class="challenge-result" id="result-${challenge.id}"></div>
                    </div>
                `).join('');
            }

            submitChallenge(id) {
                const challenge = this.challenges.find(c => c.id === id);
                const userCode = document.getElementById(`code-${id}`).value;
                
                let result;
                if (challenge.validation) {
                    const isValid = challenge.validation(userCode);
                    result = {
                        valid: isValid,
                        message: isValid ? 'Correct! Well done!' : 'Not quite right. Try again!',
                        xp: isValid ? challenge.xp : 0
                    };
                } else {
                    result = Validation.validateChallenge(challenge, userCode);
                }
                
                this.showResult(id, result);
                
                if (result.valid && !this.isCompleted(id)) {
                    this.markCompleted(id, challenge.xp);
                }
            }

            showResult(id, result) {
                const resultDiv = document.getElementById(`result-${id}`);
                resultDiv.innerHTML = `
                    <div class="result-message ${result.valid ? 'result-success' : 'result-error'}">
                        ${result.message}
                        ${result.valid ? ` (+${result.xp || 0} XP)` : ''}
                    </div>
                `;
                resultDiv.style.display = 'block';
            }

            showHint(id) {
                const challenge = this.challenges.find(c => c.id === id);
                if (challenge.hints && challenge.hints.length > 0) {
                    Utils.showNotification(challenge.hints[0], 'info', 5000);
                }
            }

            showSolution(id) {
                const challenge = this.challenges.find(c => c.id === id);
                document.getElementById(`code-${id}`).value = challenge.solution;
                Utils.showNotification('Solution revealed!', 'warning');
            }

            isCompleted(id) {
                return this.userProgress.completed.includes(id);
            }

            markCompleted(id, xp) {
                this.userProgress.completed.push(id);
                this.userProgress.totalXP += xp;
                this.storage.set('challengeProgress', this.userProgress);
                
                const card = document.querySelector(`[data-category] .challenge-card`).closest('.challenge-card');
                if (card) card.classList.add('completed');
                
                Utils.showNotification(`Challenge completed! +${xp} XP`, 'success');
            }
        }

        function filterChallenges() {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const difficultyFilter = document.getElementById('difficultyFilter').value;
            
            const cards = document.querySelectorAll('.challenge-card');
            
            cards.forEach(card => {
                const category = card.dataset.category;
                const difficulty = card.dataset.difficulty;
                
                const matchesCategory = !categoryFilter || category === categoryFilter;
                const matchesDifficulty = !difficultyFilter || difficulty === difficultyFilter;
                
                card.style.display = matchesCategory && matchesDifficulty ? 'block' : 'none';
            });
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            window.challengeSystem = new ChallengeSystem();
        });
    </script>
</body>
</html>