<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Achievement System Demo - CodeQuest</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/components.css">
    <style>
        .achievements-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .achievements-header {
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 30px;
            margin-bottom: 30px;
            text-align: center;
        }

        .progress-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .progress-stat {
            text-align: center;
        }

        .progress-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .progress-label {
            color: #666;
            font-size: 0.9rem;
        }

        .achievements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .achievement-card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 25px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .achievement-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .achievement-card.locked {
            opacity: 0.6;
            background: #f8f9fa;
        }

        .achievement-card.unlocked {
            border-color: var(--success);
            background: linear-gradient(135deg, #fff, #f0fff4);
        }

        .achievement-card.unlocked::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 0;
            height: 0;
            border-style: solid;
            border-width: 0 50px 50px 0;
            border-color: transparent var(--success) transparent transparent;
        }

        .achievement-card.unlocked::after {
            content: '✓';
            position: absolute;
            top: 8px;
            right: 8px;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .achievement-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 15px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .achievement-content {
            text-align: center;
        }

        .achievement-name {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .achievement-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .achievement-reward {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .achievement-points,
        .achievement-xp {
            background: var(--primary);
            color: white;
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .achievement-xp {
            background: var(--secondary);
        }

        .achievement-date {
            font-size: 0.8rem;
            color: var(--success);
            font-weight: 500;
            margin-top: 10px;
        }

        .demo-controls {
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 30px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group h3 {
            margin-bottom: 15px;
            color: var(--primary);
        }

        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }

        .demo-button {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .demo-button:hover {
            transform: translateY(-2px);
        }

        .filters {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid var(--border);
            background: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .event-log {
            background: #1e1e1e;
            color: #fff;
            border-radius: 10px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }

        .event-item {
            margin-bottom: 8px;
            padding: 5px 0;
            border-bottom: 1px solid #333;
        }

        .event-time {
            color: #888;
            font-size: 0.8rem;
        }

        .event-type {
            color: #4CAF50;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="achievements-container">
        <header class="header">
            <h1>Achievement System Demo</h1>
            <nav>
                <a href="index.html" class="btn btn-secondary">← Back</a>
                <button class="btn btn-primary" onclick="refreshAchievements()">Refresh</button>
            </nav>
        </header>

        <!-- Progress Overview -->
        <div class="achievements-header">
            <h2>Achievement Progress</h2>
            <div class="progress-overview" id="progressOverview">
                <!-- Progress stats will be populated here -->
            </div>
        </div>

        <!-- Demo Controls -->
        <div class="demo-controls">
            <h2>Demo Controls</h2>
            
            <div class="control-group">
                <h3>Simulate Events</h3>
                <div class="button-grid">
                    <button class="demo-button btn-primary" onclick="simulateChallenge()">Complete Challenge</button>
                    <button class="demo-button btn-secondary" onclick="simulateAttempt()">Make Attempt</button>
                    <button class="demo-button btn-warning" onclick="simulateStreak()">Update Streak</button>
                    <button class="demo-button btn-info" onclick="simulateTime()">Record Time</button>
                </div>
            </div>

            <div class="control-group">
                <h3>Achievement Actions</h3>
                <div class="button-grid">
                    <button class="demo-button btn-success" onclick="checkAchievements()">Check Achievements</button>
                    <button class="demo-button btn-warning" onclick="resetAchievements()">Reset All</button>
                    <button class="demo-button btn-info" onclick="unlockRandom()">Unlock Random</button>
                    <button class="demo-button btn-secondary" onclick="showProgress()">Show Progress</button>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="filters">
            <button class="filter-btn active" data-filter="all">All</button>
            <button class="filter-btn" data-filter="unlocked">Unlocked</button>
            <button class="filter-btn" data-filter="locked">Locked</button>
        </div>

        <!-- Achievements Grid -->
        <div class="achievements-grid" id="achievementsGrid">
            <!-- Achievements will be populated here -->
        </div>

        <!-- Event Log -->
        <div class="demo-controls">
            <h3>Event Log</h3>
            <button class="btn btn-secondary" onclick="clearEventLog()">Clear Log</button>
            <div class="event-log" id="eventLog">
                <div class="event-item">
                    <span class="event-time">[System]</span>
                    <span class="event-type">INFO:</span>
                    Achievement system initialized
                </div>
            </div>
        </div>
    </div>

    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/progress-tracker.js"></script>
    <script src="js/achievements.js"></script>
    <script>
        let achievementSystem;
        let eventLog = [];

        document.addEventListener('DOMContentLoaded', () => {
            achievementSystem = new AchievementSystem();
            setupEventListeners();
            refreshAchievements();
            setupFilters();
        });

        function setupEventListeners() {
            // Listen for achievement events
            document.addEventListener('achievement:unlocked', (e) => {
                logEvent('ACHIEVEMENT', `Unlocked: ${e.detail.name}`);
                refreshAchievements();
            });

            document.addEventListener('challenge:completed', (e) => {
                logEvent('CHALLENGE', `Completed challenge ${e.detail.challengeId}`);
            });

            document.addEventListener('challenge:attempted', (e) => {
                logEvent('ATTEMPT', `Attempted challenge ${e.detail.challengeId}`);
            });

            document.addEventListener('streak:updated', (e) => {
                logEvent('STREAK', `Streak updated to ${e.detail.streakDays} days`);
            });

            document.addEventListener('time:recorded', (e) => {
                logEvent('TIME', `Time recorded: ${e.detail.totalTime}ms total`);
            });

            document.addEventListener('xp:awarded', (e) => {
                logEvent('XP', `Awarded ${e.detail.amount} XP from ${e.detail.source}`);
            });
        }

        function refreshAchievements() {
            const progress = achievementSystem.getProgress();
            updateProgressOverview(progress);
            achievementSystem.renderAchievements('achievementsGrid');
        }

        function updateProgressOverview(progress) {
            const container = document.getElementById('progressOverview');
            container.innerHTML = `
                <div class="progress-stat">
                    <div class="progress-number">${progress.unlocked}</div>
                    <div class="progress-label">Unlocked</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-number">${progress.total}</div>
                    <div class="progress-label">Total</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-number">${Math.round(progress.percentage)}%</div>
                    <div class="progress-label">Complete</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-number">${progress.points}</div>
                    <div class="progress-label">Points</div>
                </div>
                <div class="progress-stat">
                    <div class="progress-number">${progress.xp}</div>
                    <div class="progress-label">XP</div>
                </div>
            `;
        }

        function setupFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    filterAchievements(btn.dataset.filter);
                });
            });
        }

        function filterAchievements(filter) {
            const cards = document.querySelectorAll('.achievement-card');
            cards.forEach(card => {
                const isUnlocked = card.classList.contains('unlocked');
                let show = true;

                if (filter === 'unlocked' && !isUnlocked) show = false;
                if (filter === 'locked' && isUnlocked) show = false;

                card.style.display = show ? 'block' : 'none';
            });
        }

        // Demo simulation functions
        function simulateChallenge() {
            const challengeId = Math.floor(Math.random() * 6) + 1;
            const categories = ['html', 'css', 'javascript'];
            const category = categories[Math.floor(Math.random() * categories.length)];
            
            document.dispatchEvent(new CustomEvent('challenge:completed', {
                detail: { 
                    challengeId, 
                    category,
                    timeSpent: Math.random() * 60000 + 5000,
                    attempts: Math.floor(Math.random() * 3) + 1
                }
            }));
        }

        function simulateAttempt() {
            const challengeId = Math.floor(Math.random() * 6) + 1;
            document.dispatchEvent(new CustomEvent('challenge:attempted', {
                detail: { challengeId, attempts: Math.floor(Math.random() * 5) + 1 }
            }));
        }

        function simulateStreak() {
            const currentStreak = Math.floor(Math.random() * 10) + 1;
            document.dispatchEvent(new CustomEvent('streak:updated', {
                detail: { streakDays: currentStreak, oldStreak: currentStreak - 1 }
            }));
        }

        function simulateTime() {
            const totalTime = Math.random() * 7200000; // Up to 2 hours
            const fastestTime = Math.random() * 30000 + 5000; // 5-35 seconds
            
            document.dispatchEvent(new CustomEvent('time:recorded', {
                detail: { totalTime, fastestTime }
            }));
        }

        function checkAchievements() {
            const unlocked = achievementSystem.triggerCheck();
            logEvent('SYSTEM', `Checked achievements, ${unlocked.length} newly unlocked`);
        }

        function resetAchievements() {
            if (confirm('Reset all achievements? This cannot be undone.')) {
                achievementSystem.resetAchievements();
                refreshAchievements();
                logEvent('SYSTEM', 'All achievements reset');
            }
        }

        function unlockRandom() {
            const locked = achievementSystem.achievements.filter(a => !achievementSystem.isUnlocked(a.id));
            if (locked.length > 0) {
                const random = locked[Math.floor(Math.random() * locked.length)];
                achievementSystem.unlockAchievement(random);
                logEvent('SYSTEM', `Manually unlocked: ${random.name}`);
            } else {
                logEvent('SYSTEM', 'No locked achievements to unlock');
            }
        }

        function showProgress() {
            const progress = achievementSystem.getProgress();
            alert(`Achievement Progress:\\n\\nUnlocked: ${progress.unlocked}/${progress.total}\\nCompletion: ${Math.round(progress.percentage)}%\\nTotal Points: ${progress.points}\\nTotal XP: ${progress.xp}`);
        }

        function logEvent(type, message) {
            const timestamp = new Date().toLocaleTimeString();
            eventLog.push({ timestamp, type, message });
            
            const logContainer = document.getElementById('eventLog');
            const eventItem = document.createElement('div');
            eventItem.className = 'event-item';
            eventItem.innerHTML = `
                <span class="event-time">[${timestamp}]</span>
                <span class="event-type">${type}:</span>
                ${message}
            `;
            
            logContainer.appendChild(eventItem);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Keep only last 50 events
            if (eventLog.length > 50) {
                eventLog.shift();
                logContainer.removeChild(logContainer.firstChild);
            }
        }

        function clearEventLog() {
            eventLog = [];
            document.getElementById('eventLog').innerHTML = `
                <div class="event-item">
                    <span class="event-time">[System]</span>
                    <span class="event-type">INFO:</span>
                    Event log cleared
                </div>
            `;
        }

        // Auto-simulate some activity for demo
        setTimeout(() => {
            simulateChallenge();
            setTimeout(() => simulateAttempt(), 1000);
            setTimeout(() => simulateStreak(), 2000);
        }, 1000);
    </script>
</body>
</html>